<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GanD - ToDoList</title>

  <script>
    try {
      var modeKey = "gand_todolist_mode";
      var m = localStorage.getItem(modeKey) || "light";
      if (m === "dark") document.documentElement.classList.add("dark");
    } catch (e) {}
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
    };
  </script>

  <script
    crossorigin
    src="https://unpkg.com/react@18/umd/react.development.js"
  ></script>
  <script
    crossorigin
    src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
  ></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root {
      --brand: hsl(212 90% 45%);
    }
    .btn {
      border-radius: 0.75rem;
      border: 1px solid rgba(0, 0, 0, 0.15);
      padding: 0.5rem 0.75rem;
    }
    .card {
      border-radius: 1rem;
      border: 1px solid rgba(0, 0, 0, 0.12);
      padding: 0.75rem;
    }
    .dark .btn {
      border-color: rgba(255, 255, 255, 0.18);
    }
    .dark .card {
      border-color: rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.03);
    }
    .dark input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
    }
  </style>
</head>

<body>
<div hidden>
  <span class="dark:bg-neutral-950"></span>
  <span class="dark:text-neutral-100"></span>
  <span class="dark:border-neutral-800"></span>
  <span class="dark:border-neutral-700"></span>
  <span class="dark:bg-neutral-900"></span>
  <span class="dark:bg-white/10"></span>
  <span class="dark:bg-white/20"></span>
  <span class="dark:hover:bg-white/10"></span>
  <span class="dark:bg-red-900/50"></span>
  <span class="dark:text-red-300"></span>
  <span class="dark:bg-amber-900/50"></span>
  <span class="dark:text-amber-300"></span>
  <span class="dark:bg-emerald-900/50"></span>
  <span class="dark:text-emerald-300"></span>
  <span class="dark:bg-neutral-800"></span>
  <span class="dark:hover:bg-red-500/20"></span>
</div>

<div id="root"></div>

<script type="text/babel">
  const { useReducer, useMemo, useEffect, useState, useRef } = React;
  const THEME_MODE_KEY = "gand_todolist_mode";
  const LS = {
    lists: "tdlm_lists",
    tasks: "tdlm_tasks",
    themeHue: "tdlm_theme_hue",
  };

  const uid = () =>
    Math.random().toString(36).slice(2) + Date.now().toString(36);
  const todayIso = () => new Date().toISOString().slice(0, 10);
  const nowIso = () => new Date().toISOString();

  const DEFAULT_LIST = {
    id: "inbox",
    name: "Inbox",
    icon: "üì•",
    color: "#3b82f6",
    createdAt: nowIso(),
    updatedAt: nowIso(),
  };

  const SMART_LISTS = ["myday", "planned", "important"];

  function loadLists() {
    try {
      const raw = localStorage.getItem(LS.lists);
      if (!raw) return [DEFAULT_LIST];
      const v = JSON.parse(raw);
      return v.length ? v : [DEFAULT_LIST];
    } catch {
      return [DEFAULT_LIST];
    }
  }

  function loadTasks() {
    try {
      const raw = localStorage.getItem(LS.tasks);
      return raw ? JSON.parse(raw) : [];
    } catch {
      return [];
    }
  }

  function persistLists(v) {
    localStorage.setItem(LS.lists, JSON.stringify(v));
  }
  function persistTasks(v) {
    localStorage.setItem(LS.tasks, JSON.stringify(v));
  }

  function reducer(state, action) {
    switch (action.type) {
      case "init":
        return { ...state, ...action.payload };

      case "setTheme":
        localStorage.setItem(LS.themeHue, String(action.hue));
        return { ...state, themeHue: action.hue };

      case "selectList":
        return { ...state, selectedListId: action.id };

      case "addList": {
        const list = {
          id: uid(),
          name: action.name,
          icon: "üóÇÔ∏è",
          color: `hsl(${state.themeHue} 90% 45%)`,
          createdAt: nowIso(),
          updatedAt: nowIso(),
        };
        const lists = [...state.lists, list];
        persistLists(lists);
        return { ...state, lists, selectedListId: list.id };
      }

      case "renameList": {
        const lists = state.lists.map((l) =>
          l.id === action.id
            ? { ...l, name: action.name, updatedAt: nowIso() }
            : l
        );
        persistLists(lists);
        return { ...state, lists };
      }

      case "removeList": {
        if (action.id === "inbox") return state;
        const lists = state.lists.filter((l) => l.id !== action.id);
        const tasks = state.tasks.filter((t) => t.listId !== action.id);
        persistLists(lists);
        persistTasks(tasks);
        return {
          ...state,
          lists,
          tasks,
          selectedListId:
            state.selectedListId === action.id
              ? "inbox"
              : state.selectedListId,
        };
      }

      case "addTask": {
        const baseListId = SMART_LISTS.includes(state.selectedListId)
          ? "inbox"
          : state.selectedListId;

        const task = {
          id: uid(),
          listId: action.listId || baseListId,
          title: action.title.trim(),
          notes: action.notes || "",
          status: "todo",
          priority: action.priority || "none",
          dueDate: action.dueDate,
          reminder: action.reminder,
          recurrence: action.recurrence || "none",
          tags: action.tags || [],
          createdAt: nowIso(),
          updatedAt: nowIso(),
          subtasks: [],
        };
        const tasks = [task, ...state.tasks];
        persistTasks(tasks);
        return { ...state, tasks };
      }

      case "updateTask": {
        const tasks = state.tasks.map((t) =>
          t.id === action.id
            ? { ...t, ...action.patch, updatedAt: nowIso() }
            : t
        );
        persistTasks(tasks);
        return { ...state, tasks };
      }

      case "removeTask": {
        const tasks = state.tasks.filter((t) => t.id !== action.id);
        persistTasks(tasks);
        return { ...state, tasks };
      }

      case "addSub": {
        const tasks = state.tasks.map((t) =>
          t.id === action.id
            ? {
                ...t,
                subtasks: [
                  ...(t.subtasks || []),
                  { id: uid(), title: action.title, done: false },
                ],
                updatedAt: nowIso(),
              }
            : t
        );
        persistTasks(tasks);
        return { ...state, tasks };
      }

      case "toggleSub": {
        const tasks = state.tasks.map((t) =>
          t.id === action.id
            ? {
                ...t,
                subtasks: (t.subtasks || []).map((s) =>
                  s.id === action.subId ? { ...s, done: !s.done } : s
                ),
                updatedAt: nowIso(),
              }
            : t
        );
        persistTasks(tasks);
        return { ...state, tasks };
      }

      case "removeSub": {
        const tasks = state.tasks.map((t) =>
          t.id === action.id
            ? {
                ...t,
                subtasks: (t.subtasks || []).filter((s) => s.id !== action.subId),
                updatedAt: nowIso(),
              }
            : t
        );
        persistTasks(tasks);
        return { ...state, tasks };
      }
    }
    return state;
  }

  function filterBySmartList(list, selectedListId) {
    if (selectedListId === "myday")
      return list.filter((t) => t.dueDate === todayIso());
    if (selectedListId === "planned")
      return list.filter((t) => !!t.dueDate);
    if (selectedListId === "important")
      return list.filter((t) => t.priority === "high");
    return list;
  }

  function App() {
    const [state, dispatch] = useReducer(reducer, {
      lists: [DEFAULT_LIST],
      tasks: [],
      selectedListId: "inbox",
      themeHue: Number(localStorage.getItem(LS.themeHue) || 212),
    });
    const [query, setQuery] = useState("");
    const [dense, setDense] = useState(false);
    const [sortMode, setSortMode] = useState("default");
    const [mode, setMode] = useState(
      () => localStorage.getItem(THEME_MODE_KEY) || "light"
    );

    useEffect(() => {
      dispatch({
        type: "init",
        payload: { lists: loadLists(), tasks: loadTasks() },
      });
    }, []);

    useEffect(() => {
      document.documentElement.style.setProperty(
        "--brand",
        `hsl(${state.themeHue} 90% 45%)`
      );
    }, [state.themeHue]);

    useEffect(() => {
      if (mode === "dark") {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
      localStorage.setItem(THEME_MODE_KEY, mode);
    }, [mode]);

    const currentList = useMemo(
      () =>
        state.lists.find((l) => l.id === state.selectedListId) || DEFAULT_LIST,
      [state]
    );

    const baseTasks = useMemo(() => {
      let src;
      if (
        state.selectedListId === "inbox" ||
        SMART_LISTS.includes(state.selectedListId)
      ) {
        src = state.tasks;
      } else {
        src = state.tasks.filter(
          (t) => t.listId === state.selectedListId
        );
      }

      if (query) {
        const q = query.toLowerCase();
        src = src.filter((t) =>
          [t.title, t.notes, ...(t.tags || [])]
            .join(" ")
            .toLowerCase()
            .includes(q)
        );
      }

      return src;
    }, [state.tasks, state.selectedListId, query]);

    const visibleTasks = useMemo(
      () => filterBySmartList(baseTasks, state.selectedListId),
      [baseTasks, state.selectedListId]
    );

    const sortedTasks = useMemo(() => {
      const arr = [...visibleTasks];
      if (sortMode === "default") return arr;

      const priorityRank = { high: 3, medium: 2, low: 1, none: 0 };

      return arr.sort((a, b) => {
        // 1) –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω—ñ ‚Üí –∑–∞–≤–µ—Ä—à–µ–Ω—ñ
        if (a.status !== b.status) {
          return a.status === "todo" ? -1 : 1;
        }

        // 2) –Ω–∞—è–≤–Ω—ñ—Å—Ç—å dueDate
        const ad = a.dueDate || "";
        const bd = b.dueDate || "";
        if (ad !== bd) {
          if (!ad) return 1;  // –±–µ–∑ –¥–∞—Ç–∏ ‚Äì –Ω–∏–∂—á–µ
          if (!bd) return -1;
          if (ad < bd) return -1;
          if (ad > bd) return 1;
        }

        // 3) –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: high ‚Üí medium ‚Üí low ‚Üí none
        const pa = priorityRank[a.priority || "none"] ?? 0;
        const pb = priorityRank[b.priority || "none"] ?? 0;
        if (pa !== pb) return pb - pa;

        // 4) —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è (—Å—Ç–∞—Ä—ñ—à—ñ –≤–∏—â–µ)
        if (a.createdAt < b.createdAt) return -1;
        if (a.createdAt > b.createdAt) return 1;

        return 0;
      });
    }, [visibleTasks, sortMode]);

    const plannedCount = state.tasks.filter(
      (t) => !!t.dueDate && t.status !== "done"
    ).length;
    const importantCount = state.tasks.filter(
      (t) => t.priority === "high" && t.status !== "done"
    ).length;
    const todayCount = state.tasks.filter(
      (t) => t.dueDate === todayIso() && t.status !== "done"
    ).length;

    const selectedTitle = (() => {
      switch (state.selectedListId) {
        case "inbox":
          return "All";
        case "myday":
          return "My Day";
        case "planned":
          return "Planned";
        case "important":
          return "Important";
        default:
          return currentList.name || "List";
      }
    })();

    return (
      <div className="grid min-h-screen grid-cols-1 md:grid-cols-[300px_1fr] bg-white text-black dark:bg-neutral-950 dark:text-neutral-100">
        <aside className="border-r border-neutral-200 dark:border-neutral-800 p-3 space-y-3">
          <div className="flex items-center justify-between">
            <div
              className="text-2xl font-bold"
              style={{ color: "var(--brand)" }}
            >
              GanD - ToDoList
            </div>
            <div className="flex items-center gap-2">
              <button
                className="btn"
                onClick={() =>
                  dispatch({
                    type: "setTheme",
                    hue: (state.themeHue + 30) % 360,
                  })
                }
              >
                üé®
              </button>
              <button
                className="btn"
                onClick={() => setMode(mode === "dark" ? "light" : "dark")}
              >
                {mode === "dark" ? "üåû" : "üåô"}
              </button>
            </div>
          </div>

          <div className="relative">
            <span className="absolute left-3 top-2.5 opacity-60">üîé</span>
            <input
              className="w-full rounded-xl border bg-white dark:bg-neutral-900 dark:border-neutral-800 pl-8 pr-3 py-2"
              placeholder="–ü–æ—à—É–∫ –∑–∞–¥–∞—á‚Ä¶"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
            />
          </div>

          <div className="space-y-1">
            <SidebarItem
              active={state.selectedListId === "inbox"}
              onClick={() => dispatch({ type: "selectList", id: "inbox" })}
              icon="üìö"
              label="All"
              badge={state.tasks.filter((t) => t.status !== "done").length}
            />
            <SidebarItem
              active={state.selectedListId === "myday"}
              onClick={() => dispatch({ type: "selectList", id: "myday" })}
              icon="üìÖ"
              label="My Day"
              badge={todayCount}
            />
            <SidebarItem
              active={state.selectedListId === "planned"}
              onClick={() =>
                dispatch({ type: "selectList", id: "planned" })
              }
              icon="‚è∞"
              label="Planned"
              badge={plannedCount}
            />
            <SidebarItem
              active={state.selectedListId === "important"}
              onClick={() =>
                dispatch({ type: "selectList", id: "important" })
              }
              icon="‚≠ê"
              label="Important"
              badge={importantCount}
            />
          </div>

          <div className="pt-2">
            <div className="mb-2 text-xs uppercase opacity-60">Lists</div>
            <div className="space-y-1">
              {state.lists.map((l) => (
                <SidebarItem
                  key={l.id}
                  active={state.selectedListId === l.id}
                  onClick={() => dispatch({ type: "selectList", id: l.id })}
                  icon={l.icon || "üóÇÔ∏è"}
                  label={l.name}
                  badge={
                    state.tasks.filter(
                      (t) => t.listId === l.id && t.status !== "done"
                    ).length
                  }
                />
              ))}
            </div>
            <button
              className="mt-2 btn"
              onClick={() => {
                const name = prompt("New list name");
                if (name) dispatch({ type: "addList", name });
              }}
            >
              ‚ûï Add list
            </button>
          </div>
        </aside>

        <main className="p-4 space-y-5">
          <SectionTitle
            icon="‚úÖ"
            title={selectedTitle}
            right={
              <div className="flex items-center gap-2">
                <button className="btn" onClick={() => setDense((v) => !v)}>
                  Density: {dense ? "Compact" : "Comfort"}
                </button>
                <button
                  className="btn"
                  onClick={() =>
                    setSortMode((m) =>
                      m === "default" ? "smart" : "default"
                    )
                  }
                >
                  {sortMode === "default" ? "üßπ Sort" : "üßπ Sorted"}
                </button>
              </div>
            }
          />

          <QuickAdd
            onAdd={(title) => {
              const payload = { type: "addTask", title };

              if (state.selectedListId === "myday") {
                payload.dueDate = todayIso();
              }
              if (state.selectedListId === "planned") {
                payload.dueDate = todayIso();
              }
              if (state.selectedListId === "important") {
                payload.priority = "high";
              }

              dispatch(payload);
            }}
          />

          <TaskList
            dense={dense}
            tasks={sortedTasks}
            onToggle={(id, done) =>
              dispatch({
                type: "updateTask",
                id,
                patch: { status: done ? "done" : "todo" },
              })
            }
            onUpdate={(id, patch) =>
              dispatch({ type: "updateTask", id, patch })
            }
            onDelete={(id) => dispatch({ type: "removeTask", id })}
            onAddSubtask={(id, title) =>
              dispatch({ type: "addSub", id, title })
            }
            onToggleSubtask={(id, subId) =>
              dispatch({ type: "toggleSub", id, subId })
            }
            onRemoveSubtask={(id, subId) =>
              dispatch({ type: "removeSub", id, subId })
            }
          />
        </main>
      </div>
    );
  }

  function SectionTitle({ icon, title, right }) {
    return (
      <div className="flex items-center justify-between border-b pb-2 dark:border-neutral-800">
        <div className="flex items-center gap-2 text-xl font-semibold">
          <span className="opacity-80">{icon}</span>
          <span>{title}</span>
        </div>
        {right}
      </div>
    );
  }

  function SidebarItem({ active, onClick, icon, label, badge }) {
    return (
      <button
        onClick={onClick}
        className={
          "flex w-full items-center justify-between rounded-xl px-3 py-2 text-left hover:bg-black/5 dark:hover:bg:white/10 " +
          (active ? "bg-black/5 dark:bg-white/10" : "")
        }
      >
        <span className="flex items-center gap-2">
          <span className="opacity-80">{icon}</span>
          <span>{label}</span>
        </span>
        {badge > 0 && (
          <span className="rounded-full bg-black/10 dark:bg-white/20 px-2 text-xs">
            {badge}
          </span>
        )}
      </button>
    );
  }

  function QuickAdd({ onAdd }) {
    const [title, setTitle] = useState("");
    const inputRef = useRef(null);

    useEffect(() => {
      const handler = (e) => {
        if (document.activeElement?.tagName === "INPUT") return;
        if (e.key.toLowerCase() === "n") inputRef.current?.focus();
        if (e.key === "/") {
          document
            .querySelector("input[placeholder='–ü–æ—à—É–∫ –∑–∞–¥–∞—á‚Ä¶']")
            ?.focus();
          e.preventDefault();
        }
      };
      window.addEventListener("keydown", handler);
      return () => window.removeEventListener("keydown", handler);
    }, []);

    return (
      <div className="flex items:center gap-2">
        <input
          ref={inputRef}
          className="flex-1 rounded-xl border bg-white dark:bg-neutral-900 dark:border-neutral-700 px-3 py-2"
          placeholder="–î–æ–¥–∞—Ç–∏ –∑–∞–¥–∞—á—É (Enter)‚Ä¶"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
          onKeyDown={(e) => {
            if (e.key === "Enter" && title.trim()) {
              onAdd(title);
              setTitle("");
            }
          }}
        />
        <button
          className="rounded-xl px-3 py-2 text-white"
          style={{ background: "var(--brand)" }}
          onClick={() => {
            if (!title.trim()) return;
            onAdd(title);
            setTitle("");
          }}
        >
          ‚ûï Add
        </button>
      </div>
    );
  }

  function TaskList({ tasks, dense, ...props }) {
    if (!tasks.length)
      return <div className="opacity-60">–ü–æ–∫–∏ –Ω–µ–º–∞—î –∑–∞–¥–∞—á.</div>;
    return (
      <div className="space-y-2">
        {tasks.map((t) => (
          <TaskRow key={t.id} task={t} dense={dense} {...props} />
        ))}
      </div>
    );
  }

  function TaskRow({
    task,
    dense,
    onToggle,
    onUpdate,
    onDelete,
    onAddSubtask,
    onToggleSubtask,
    onRemoveSubtask,
  }) {
    const [open, setOpen] = useState(false);
    const [editing, setEditing] = useState(false);
    const [title, setTitle] = useState(task.title);
       const [tagInput, setTagInput] = useState("");
    const [subInput, setSubInput] = useState("");
    const overdue =
      task.dueDate && new Date(task.dueDate) < new Date(todayIso());

    return (
      <div className={"card " + (dense ? "text-sm" : "")}>
        <div className="flex items-start gap-3">
          <input
            type="checkbox"
            className="mt-1 h-5 w-5"
            checked={task.status === "done"}
            onChange={(e) => onToggle(task.id, e.target.checked)}
          />
          <div className="flex-1">
            {editing ? (
              <input
                className="w-full rounded-lg border px-2 py-1 dark:bg-neutral-900"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === "Enter") {
                    onUpdate(task.id, { title });
                    setEditing(false);
                  }
                }}
              />
            ) : (
              <div className="flex items-center gap-2">
                <div
                  className={
                    "font-medium " +
                    (task.status === "done"
                      ? "line-through opacity-60"
                      : "")
                  }
                >
                  {task.title}
                </div>
                {task.priority !== "none" && (
                  <span
                    className={
                      "rounded-full px-2 py-0.5 text-xs " +
                      (task.priority === "high"
                        ? "bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300"
                        : task.priority === "medium"
                        ? "bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300"
                        : "bg-emerald-100 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300")
                    }
                  >
                    {task.priority}
                  </span>
                )}
              </div>
            )}

            <div className="mt-1 flex flex-wrap items-center gap-2 opacity-80">
              {task.dueDate && (
                <span
                  className={
                    "inline-flex items-center gap-1 rounded-lg border px-2 py-0.5 text-xs " +
                    (overdue
                      ? "border-red-300 text-red-700 dark:border-red-700 dark:text-red-300"
                      : "dark:border-neutral-700")
                  }
                >
                  üìÖ {task.dueDate}
                </span>
              )}
              {(task.tags || []).map((tag) => (
                <span
                  key={tag}
                  className="inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs dark:border-neutral-700"
                >
                  üè∑Ô∏è {tag}
                </span>
              ))}
            </div>

            {open && (
              <div className="mt-3 space-y-3">
                <div className="grid grid-cols-1 gap-2 md:grid-cols-4">
                  <select
                    className="rounded-lg border px-2 py-1 dark:bg-neutral-800 dark:border-neutral-700"
                    value={task.priority}
                    onChange={(e) =>
                      onUpdate(task.id, { priority: e.target.value })
                    }
                  >
                    <option value="none">Priority: none</option>
                    <option value="low">Priority: low</option>
                    <option value="medium">Priority: medium</option>
                    <option value="high">Priority: high</option>
                  </select>

                  <input
                    type="date"
                    className="rounded-lg border px-2 py-1 dark:bg-neutral-800 dark:border-neutral-700"
                    value={task.dueDate || ""}
                    onChange={(e) =>
                      onUpdate(task.id, { dueDate: e.target.value })
                    }
                  />

                  <input
                    type="datetime-local"
                    className="rounded-lg border px-2 py-1 dark:bg-neutral-800 dark:border-neutral-700"
                    value={task.reminder || ""}
                    onChange={(e) =>
                      onUpdate(task.id, { reminder: e.target.value })
                    }
                  />

                  <select
                    className="rounded-lg border px-2 py-1 dark:bg-neutral-800 dark:border-neutral-700"
                    value={task.recurrence || "none"}
                    onChange={(e) =>
                      onUpdate(task.id, { recurrence: e.target.value })
                    }
                  >
                    <option value="none">No recurrence</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                  </select>
                </div>

                <div>
                  <div className="mb-1 text-sm opacity-70">Notes</div>
                  <textarea
                    className="w-full rounded-lg border p-2 dark:bg-neutral-800 dark:border-neutral-700"
                    rows="3"
                    value={task.notes || ""}
                    onChange={(e) =>
                      onUpdate(task.id, { notes: e.target.value })
                    }
                  ></textarea>
                </div>

                <div>
                  <div className="mb-1 text-sm opacity-70">Tags</div>
                  <div className="flex items-center gap-2">
                    <input
                      className="flex-1 rounded-lg border px-2 py-1 dark:bg-neutral-800 dark:border-neutral-700"
                      placeholder="Add tag..."
                      value={tagInput}
                      onChange={(e) => setTagInput(e.target.value)}
                      onKeyDown={(e) => {
                        if (e.key === "Enter" && tagInput.trim()) {
                          onUpdate(task.id, {
                            tags: [...(task.tags || []), tagInput.trim()],
                          });
                          setTagInput("");
                        }
                      }}
                    />
                  </div>
                  <div className="mt-2 flex flex-wrap gap-2">
                    {(task.tags || []).map((tag) => (
                      <span
                        key={tag}
                        className="inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs dark:border-neutral-700"
                      >
                        üè∑Ô∏è {tag}
                        <button
                          className="opacity-60 hover:opacity-100 ml-1"
                          onClick={() =>
                            onUpdate(task.id, {
                              tags: (task.tags || []).filter(
                                (t) => t !== tag
                              ),
                            })
                          }
                          title="–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–µ–≥"
                        >
                          ‚úñ
                        </button>
                      </span>
                    ))}
                  </div>
                </div>

                <div>
                  <div className="mb-1 text-sm opacity-70">Subtasks</div>
                  <div className="space-y-2">
                    {(task.subtasks || []).map((s) => (
                      <div key={s.id} className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={s.done}
                          onChange={() => onToggleSubtask(task.id, s.id)}
                        />
                        <div
                          className={
                            "flex-1 " +
                            (s.done ? "line-through opacity-60" : "")
                          }
                        >
                          {s.title}
                        </div>
                        <button
                          className="rounded-lg p-1 hover:bg-black/5 dark:hover:bg-white/10"
                          onClick={() => onRemoveSubtask(task.id, s.id)}
                        >
                          üóëÔ∏è
                        </button>
                      </div>
                    ))}
                    <div className="flex items-center gap-2">
                      <input
                        className="flex-1 rounded-lg border px-2 py-1 dark:bg-neutral-800 dark:border-neutral-700"
                        placeholder="New subtask"
                        value={subInput}
                        onChange={(e) => setSubInput(e.target.value)}
                        onKeyDown={(e) => {
                          if (e.key === "Enter" && subInput.trim()) {
                            onAddSubtask(task.id, subInput.trim());
                            setSubInput("");
                          }
                        }}
                      />
                      <button
                        className="btn"
                        onClick={() => {
                          if (!subInput.trim()) return;
                          onAddSubtask(task.id, subInput.trim());
                          setSubInput("");
                        }}
                      >
                        ‚ûï
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>

          <div className="ml-auto flex items-center gap-1">
            <button
              className="rounded-lg p-2 hover:bg-black/5 dark:hover:bg-white/10"
              onClick={() => setEditing((v) => !v)}
              title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏"
            >
              ‚úèÔ∏è
            </button>
            <button
              className="rounded-lg p-2 hover:bg-black/5 dark:hover:bg-white/10"
              onClick={() => setOpen((v) => !v)}
              title="–î–µ—Ç–∞–ª—ñ"
            >
              {open ? "üîΩ" : "‚ñ∂Ô∏è"}
            </button>
            <button
              className="rounded-lg p-2 hover:bg-red-50 dark:hover:bg-red-500/20"
              onClick={() => onDelete(task.id)}
              title="–í–∏–¥–∞–ª–∏—Ç–∏"
            >
              üóëÔ∏è
            </button>
          </div>
        </div>
      </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById("root"));
  root.render(<App />);
</script>
</body>
</html>
